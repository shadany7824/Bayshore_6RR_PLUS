// Bayshore 6RR Plus Schema - Compatible with PostgreSQL 18
generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("POSTGRES_URL")
}

model User {
    id                 Int            @id @default(autoincrement())
    chipId             String         @unique
    accessCode         String
    cars               Car[]
    carOrder           Int[]
    items              UserItem[]
    tutorials          Boolean[]
    userBanned         Boolean        @default(false)
    bookmarks          Int[]
    ScratchSheet       ScratchSheet[]
    currentSheet       Int            @default(1)
    lastScratched      Int            @default(0)
    receivedNumOfItems Int            @default(1)
}

model ScratchSheet {
    id      Int             @id @default(autoincrement())
    User    User            @relation(fields: [userId], references: [id])
    userId  Int
    sheetNo Int 
    squares ScratchSquare[]
}

model ScratchSquare {
    id       Int          @id @default(autoincrement())
    Sheet    ScratchSheet @relation(fields: [sheetId], references: [id])
    sheetId  Int
    category Int
    itemId   Int
    earned   Boolean
}

model UserItem {
    userItemId Int  @id @default(autoincrement())
    category   Int
    itemId     Int
    User       User @relation(fields: [userId], references: [id])
    userId     Int
    type       Int  @default(0)
    earnedAt   Int  @default(0)
}

model Car {
    user                User @relation(fields: [userId], references: [id])
    userId              Int
    carId               Int     @id @default(autoincrement())
    name                String
    manufacturer        Int
    model               Int
    visualModel         Int
    customColor         Int     @default(0)
    defaultColor        Int
    wheel               Int     @default(0)
    wheelColor          Int     @default(0)
    aero                Int     @default(0)
    bonnet              Int     @default(0)
    wing                Int     @default(0)
    mirror              Int     @default(0)
    neon                Int     @default(0)
    trunk               Int     @default(0)
    plate               Int     @default(0)
    plateColor          Int     @default(0)
    plateNumber         Int     @default(0)
    tunePower           Int     @default(0)
    tuneHandling        Int     @default(0)
    title               String  @default("New Car")
    level               Int     @default(0)
    windowSticker       Boolean @default(false)
    windowStickerString String  @default("ＷＡＮＧＡＮ")
    windowStickerFont   Int     @default(0)
    windowDecoration    Int     @default(0)
    rivalMarker         Int     @default(0)
    lastPlayedAt        Int     @default(0)
    aura                Int     @default(0)
    regionId            Int     @default(0)
    country             String  @default("JPN")
    customFrame         Int     @default(0)
    acquiredBingoNumbers Int[]
    
    // FIX: Missing column for WMMT6 server data
    rgRegions           Int[]   @default([])

    GhostExpedition GhostExpedition[]
    GhostExpeditionWantedCar GhostExpeditionWantedCar[]
}

model Shop {
    dbId     Int    @id @default(autoincrement())
    car      Car[]
    placeId  String
    regionId Int
    shopName String
    country  String
}

model GhostExpedition {
    dbId               Int @id @default(autoincrement())
    car                Car @relation(fields: [carId], references: [carId])
    carId              Int
    ghostExpeditionId Int
    sugorokuPoint      Int @default(0)
    earnedScore        Int @default(0)
    score              Int @default(0)
}

model GhostExpeditionWantedCar {
    dbId               Int     @id @default(autoincrement())
    car                Car     @relation(fields: [carId], references: [carId])
    carId              Int
    bonus              Int     @default(0)
    numOfHostages      Int     @default(1)
    defeatedMeCount    Int     @default(1)
    hostage            Int?
    ghostExpeditionId Int     @default(1)
    area               Int     @default(0)
    locked             Boolean @default(false)
    lockTime           Int     @default(0)
    challengerCarId   Int?
}

model GhostExpeditionEvent {
    dbId               Int    @id @default(autoincrement())
    ghostExpeditionId Int
    startAt            Int
    endAt              Int
    aftereventEndAt    Int
    opponentCountry    String
}
